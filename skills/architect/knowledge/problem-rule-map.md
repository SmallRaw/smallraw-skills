# 问题-规则映射表

> 当遇到问题时，查阅此表找到对应的规则。
> 基于 OpenClaw 项目 125 次 AGENTS.md 提交的完整分析。

---

## 快速索引

| 问题关键词 | 跳转 |
|-----------|------|
| 提交、commit、git add、敏感信息 | [安全规则 S1-S7](#安全规则) |
| 覆盖、丢失、冲突、stash、分支 | [协作规则 M1-M10](#协作规则) |
| PR、合并、review、changelog | [流程规则 P1-P11](#流程规则) |
| 格式、风格、命名、代码质量 | [风格规则 C1-C8](#风格规则) |
| 找不到、不知道、文档 | [知识规则 K1-K8](#知识规则) |
| 文档、链接、示例 | [文档规则 D1-D4](#文档规则) |
| 工具、schema、API | [工具规则 T1-T2](#工具规则) |
| 发布、版本、npm | [发布规则 R1-R4](#发布规则) |

---

## 安全规则

### S1: 禁止 git add . / git add -A

| 项目 | 内容 |
|------|------|
| **问题信号** | "提交了不该提交的文件"、"提交了 .env"、"提交了 node_modules" |
| **根本原因** | `git add .` 会暂存所有文件，包括敏感文件和大文件 |
| **规则** | 禁止使用 `git add .` 和 `git add -A`，使用 `scripts/committer` 或明确指定文件 |
| **自动化** | committer 脚本会拒绝 "." 参数 |
| **来源** | commit `1f19ca166` - 引入 committer helper |
| **通用程度** | ⭐⭐⭐⭐⭐ 所有项目适用 |

### S2: 禁止编辑 node_modules

| 项目 | 内容 |
|------|------|
| **问题信号** | "改了依赖但又没了"、"npm install 后改动消失" |
| **根本原因** | node_modules 会被 npm/pnpm install 覆盖 |
| **规则** | 永远不要编辑 node_modules（包括全局、Homebrew、npm、git 安装的） |
| **自动化** | committer 脚本会拒绝 node_modules 路径 |
| **来源** | commit `de33bc70e` - clarify node_modules guidance |
| **通用程度** | ⭐⭐⭐⭐⭐ 所有 Node.js 项目适用 |

### S3: 禁止提交敏感信息

| 项目 | 内容 |
|------|------|
| **问题信号** | "泄露了 API key"、"提交了真实手机号"、"提交了真实视频" |
| **根本原因** | 敏感信息进入 git 历史后很难完全清除 |
| **规则** | 使用明显的假数据 placeholder，检查 .gitignore |
| **自动化** | 可使用 detect-secrets pre-commit hook |
| **来源** | commit `753995a91` - add no-real-data rule |
| **通用程度** | ⭐⭐⭐⭐⭐ 所有项目适用 |

### S4: 版本号修改需要批准

| 项目 | 内容 |
|------|------|
| **问题信号** | "发布了不该发布的版本"、"版本号改错了" |
| **根本原因** | 版本号影响发布，误改可能导致问题 |
| **规则** | 修改版本号前必须获得明确批准 |
| **自动化** | 无，靠规则约束 |
| **来源** | commit `868952f95` - add release guardrails |
| **通用程度** | ⭐⭐⭐⭐⭐ 所有有发布的项目适用 |

### S5: Patch 依赖使用精确版本

| 项目 | 内容 |
|------|------|
| **问题信号** | "patch 应用失败"、"patch 和版本不匹配" |
| **根本原因** | patch 针对特定版本，版本升级后可能失效 |
| **规则** | 有 `pnpm.patchedDependencies` 的依赖必须用精确版本（无 `^` `~`） |
| **自动化** | 可在 CI 中检查 |
| **来源** | CLAUDE.md 第 130 行 |
| **通用程度** | ⭐⭐⭐⭐ 使用 patch 的项目适用 |

### S6: Patch 依赖需要明确批准

| 项目 | 内容 |
|------|------|
| **问题信号** | "依赖被意外 patch 了"、"patch 引入了问题" |
| **根本原因** | Patch 是侵入性操作，可能引入维护负担 |
| **规则** | pnpm patches、overrides、vendored changes 都需要明确批准，不要默认这样做 |
| **自动化** | 无，靠规则约束 |
| **来源** | commit `173bce34b` - add dep patch approval rule |
| **通用程度** | ⭐⭐⭐⭐ 所有项目适用 |

### S7: 禁止锁定特定依赖

| 项目 | 内容 |
|------|------|
| **问题信号** | "为什么这个依赖不能升级" |
| **根本原因** | 某些依赖有特殊原因不能升级 |
| **规则** | 记录哪些依赖不能升级及原因（如 "Never update the Carbon dependency"） |
| **自动化** | 无 |
| **来源** | CLAUDE.md 第 129 行 |
| **通用程度** | ⭐⭐⭐ 有特殊依赖的项目适用 |

---

## 协作规则

### M1: 禁止 git stash

| 项目 | 内容 |
|------|------|
| **问题信号** | "我的改动不见了"、"stash 被覆盖了"、"stash 冲突" |
| **根本原因** | 多个 Agent/人同时使用 stash 会互相覆盖 |
| **规则** | 禁止 git stash（包括 `git pull --rebase --autostash`），除非用户明确要求 |
| **自动化** | 可加 pre-commit hook 检测 |
| **来源** | commit `952810f76` - forbid git stash without consent |
| **通用程度** | ⭐⭐⭐⭐⭐ 多 Agent 协作必备 |

### M2: 禁止切换分支

| 项目 | 内容 |
|------|------|
| **问题信号** | "分支被切走了"、"我在错误的分支上" |
| **根本原因** | 切换分支会影响其他 Agent 的工作上下文 |
| **规则** | 禁止切换分支 / checkout 不同分支，除非用户明确要求 |
| **自动化** | 无，靠规则约束 |
| **来源** | commit `cc235fc31` - require permission to switch branches |
| **通用程度** | ⭐⭐⭐⭐⭐ 多 Agent 协作必备 |

### M3: 禁止修改 worktree

| 项目 | 内容 |
|------|------|
| **问题信号** | "worktree 被删了"、"worktree 配置乱了" |
| **根本原因** | worktree 是共享资源 |
| **规则** | 禁止创建/删除/修改 git worktree 或编辑 `.worktrees/*`，除非用户明确要求 |
| **自动化** | 无，靠规则约束 |
| **来源** | commit `beb5b1ad5` - require consent for worktrees |
| **通用程度** | ⭐⭐⭐⭐ 使用 worktree 的项目适用 |

### M4: Commit 只 scope 自己的改动

| 项目 | 内容 |
|------|------|
| **问题信号** | "我的 WIP 被提交了"、"提交了不该提交的文件" |
| **根本原因** | 多 Agent 同时工作，可能有未完成的改动 |
| **规则** | 当用户说 "commit" 时，只提交自己明确修改的文件；"commit all" 时分组提交 |
| **自动化** | committer 脚本强制指定文件 |
| **来源** | CLAUDE.md 第 147 行 |
| **通用程度** | ⭐⭐⭐⭐⭐ 多 Agent 协作必备 |

### M5: 看到不认识的文件，继续工作

| 项目 | 内容 |
|------|------|
| **问题信号** | "Agent 因为未知文件停止了"、"Agent 问要不要处理别的文件" |
| **根本原因** | 其他 Agent 可能正在工作 |
| **规则** | 看到不认识的文件，忽略它，专注自己的任务，只提交自己的改动 |
| **自动化** | 无，靠规则约束 |
| **来源** | commit `a40fd5219` - clarify unrecognized file handling |
| **通用程度** | ⭐⭐⭐⭐⭐ 多 Agent 协作必备 |

### M6: 报告只关注自己的改动

| 项目 | 内容 |
|------|------|
| **问题信号** | "报告太长了"、"报告包含无关信息"、"太多 guardrail disclaimers" |
| **根本原因** | Agent 报告了不相关的内容 |
| **规则** | 报告只描述自己做了什么，避免 guardrail disclaimers，最后简短提一下 "other files present" 即可 |
| **自动化** | 无，靠规则约束 |
| **来源** | commit `c807c7e72` - clarify multi-agent reporting |
| **通用程度** | ⭐⭐⭐⭐ 多 Agent 协作适用 |

### M7: 多 Agent 各自独立 session

| 项目 | 内容 |
|------|------|
| **问题信号** | "session 冲突"、"上下文混乱" |
| **根本原因** | 共享 session 导致状态混乱 |
| **规则** | 每个 Agent 使用独立的 session，多 Agent 同时运行是 OK 的 |
| **自动化** | 由 Agent 框架保证 |
| **来源** | commit `9fa919974` - note multi-agent session rule |
| **通用程度** | ⭐⭐⭐⭐ 多 Agent 协作适用 |

### M8: Push 时可以 rebase 但不丢弃工作

| 项目 | 内容 |
|------|------|
| **问题信号** | "push 失败因为落后"、"别人的工作被丢弃了" |
| **根本原因** | 其他人/Agent 已经推送了新的提交 |
| **规则** | 当用户说 "push" 时，可以 `git pull --rebase` 集成最新改动，但永远不要丢弃别人的工作 |
| **自动化** | 无，靠规则约束 |
| **来源** | CLAUDE.md 第 147 行 |
| **通用程度** | ⭐⭐⭐⭐⭐ 多人协作适用 |

### M9: Review 前先 git pull

| 项目 | 内容 |
|------|------|
| **问题信号** | "review 的代码不是最新的"、"本地有未提交的改动" |
| **根本原因** | 本地状态和远程不同步 |
| **规则** | 开始 review 前先 `git pull`；如果有本地改动或未推送的提交，停下来提醒用户 |
| **自动化** | 无，靠规则约束 |
| **来源** | commit `52e9450a7` - require git pull before review |
| **通用程度** | ⭐⭐⭐⭐⭐ 有 PR 流程的项目适用 |

### M10: 多 Agent 触碰同文件时继续

| 项目 | 内容 |
|------|------|
| **问题信号** | "Agent 因为冲突停止了" |
| **根本原因** | Agent 过于谨慎 |
| **规则** | 当多个 Agent 触碰同一个文件时，如果安全就继续 |
| **自动化** | 无，靠规则约束 |
| **来源** | CLAUDE.md 第 157 行 |
| **通用程度** | ⭐⭐⭐⭐ 多 Agent 协作适用 |

---

## 流程规则

### P1: 使用 committer 脚本提交

| 项目 | 内容 |
|------|------|
| **问题信号** | "提交了太多文件"、"提交范围失控" |
| **根本原因** | 手动 git add/commit 容易出错 |
| **规则** | 使用 `scripts/committer "<msg>" <files...>`，避免手动 `git add`/`git commit` |
| **自动化** | committer 脚本（见 `starter/committer`） |
| **来源** | commit `1f19ca166` - add committer helper |
| **通用程度** | ⭐⭐⭐⭐⭐ 所有项目适用 |

### P2: PR Review 只看不改

| 项目 | 内容 |
|------|------|
| **问题信号** | "审查时意外改了代码"、"不知道改了什么" |
| **根本原因** | Review 模式和 Land 模式混淆 |
| **规则** | Review 模式只用 `gh pr view`/`gh pr diff`，不改代码不切分支 |
| **自动化** | 无，靠规则约束 |
| **来源** | CLAUDE.md 第 107 行 |
| **通用程度** | ⭐⭐⭐⭐⭐ 有 PR 流程的项目适用 |

### P3: PR Land 使用临时分支

| 项目 | 内容 |
|------|------|
| **问题信号** | "git 历史很乱"、"不知道谁做的改动" |
| **根本原因** | 直接在 main 上改动 |
| **规则** | 创建临时分支 → 合并 PR（prefer rebase）→ 运行 gate → 合回 main → 删临时分支 → 回到 main |
| **自动化** | 无，靠规则约束 |
| **来源** | commit `4cf02cc70` - prefer rebase + run gate before commits |
| **通用程度** | ⭐⭐⭐⭐⭐ 有 PR 流程的项目适用 |

### P4: PR 合并后添加 changelog

| 项目 | 内容 |
|------|------|
| **问题信号** | "不知道这个版本改了什么"、"changelog 不完整" |
| **根本原因** | 忘记更新 changelog |
| **规则** | 每个 PR 合并后添加 changelog 条目，包含 PR 号和 `(thanks @contributor)` |
| **自动化** | 可在 CI 中检查 |
| **来源** | CLAUDE.md 第 95-96 行 |
| **通用程度** | ⭐⭐⭐⭐ 有发布流程的项目适用 |

### P5: 推送前运行测试

| 项目 | 内容 |
|------|------|
| **问题信号** | "CI 失败了"、"本地没问题 CI 挂了" |
| **根本原因** | 推送前没跑测试 |
| **规则** | 修改逻辑代码后，推送前运行 `pnpm test` 或等效命令 |
| **自动化** | 可用 pre-push hook |
| **来源** | CLAUDE.md 第 75 行 |
| **通用程度** | ⭐⭐⭐⭐⭐ 有测试的项目适用 |

### P6: Conventional Commits 格式

| 项目 | 内容 |
|------|------|
| **问题信号** | "提交信息看不懂"、"不知道这个提交做了什么" |
| **根本原因** | 提交信息格式不统一 |
| **规则** | 简洁、行动导向的消息，如 `CLI: add verbose flag to send` |
| **自动化** | 可用 commitlint |
| **来源** | CLAUDE.md 第 85 行 |
| **通用程度** | ⭐⭐⭐⭐⭐ 所有项目适用 |

### P7: Lint/Format 改动自动处理

| 项目 | 内容 |
|------|------|
| **问题信号** | "每次都问要不要处理格式"、"太啰嗦" |
| **根本原因** | 格式改动和逻辑改动混在一起 |
| **规则** | 纯格式改动自动处理不需确认；已请求 commit/push 时自动包含格式修复；只有语义变化才需要问 |
| **自动化** | pre-commit hook 自动格式化 |
| **来源** | commit `f07c39b26` - handle lint/format churn |
| **通用程度** | ⭐⭐⭐⭐ 有格式工具的项目适用 |

### P8: 合并前运行完整 Gate

| 项目 | 内容 |
|------|------|
| **问题信号** | "合并后 CI 挂了"、"合并后发现问题" |
| **根本原因** | 合并前没跑完整检查 |
| **规则** | `pnpm lint && pnpm build && pnpm test` 必须全部通过 |
| **自动化** | 可用 CI 强制 |
| **来源** | CLAUDE.md 第 108 行 |
| **通用程度** | ⭐⭐⭐⭐⭐ 所有项目适用 |

### P9: PR 合并后感谢贡献者

| 项目 | 内容 |
|------|------|
| **问题信号** | "贡献者没有被感谢"、"社区参与感低" |
| **根本原因** | 忘记感谢 |
| **规则** | changelog 条目包含 `(thanks @contributor)`；如果 squash，添加 PR 作者为 co-contributor |
| **自动化** | 无 |
| **来源** | CLAUDE.md 第 93-94 行 |
| **通用程度** | ⭐⭐⭐⭐ 开源项目适用 |

### P10: PR 合并后留评论

| 项目 | 内容 |
|------|------|
| **问题信号** | "不知道 PR 是怎么合并的" |
| **根本原因** | 缺乏透明度 |
| **规则** | 合并 PR 后留评论，解释做了什么，包含 SHA hashes |
| **自动化** | 无 |
| **来源** | CLAUDE.md 第 97 行 |
| **通用程度** | ⭐⭐⭐⭐ 有 PR 流程的项目适用 |

### P11: PR review 优化调用

| 项目 | 内容 |
|------|------|
| **问题信号** | "API 调用太多"、"review 太慢" |
| **根本原因** | 多次调用 gh 命令 |
| **规则** | 优先用一个 `gh pr view --json ...` 批量获取 metadata/comments；只在需要时运行 `gh pr diff` |
| **自动化** | 无 |
| **来源** | commit `44d55667d` - optimize PR review calls |
| **通用程度** | ⭐⭐⭐⭐ 有 PR 流程的项目适用 |

---

## 风格规则

### C1: 文件不超过 500 行

| 项目 | 内容 |
|------|------|
| **问题信号** | "这个文件太长了"、"看不懂这个文件" |
| **根本原因** | 文件太大难以理解和维护 |
| **规则** | 单文件不超过 ~500 行（指导原则，软限制 ~700 行），超过时拆分/重构 |
| **自动化** | 可用 lint 规则或脚本检查 |
| **来源** | commit `9c32e630a` - add 500 LOC cap |
| **通用程度** | ⭐⭐⭐⭐⭐ 所有项目适用 |

### C2: 严格类型，避免 any

| 项目 | 内容 |
|------|------|
| **问题信号** | "类型错误"、"运行时报错" |
| **根本原因** | any 绕过了类型检查 |
| **规则** | 禁止使用 any，使用 unknown 或具体类型 |
| **自动化** | TypeScript strict 模式 + lint |
| **来源** | CLAUDE.md 第 58 行 |
| **通用程度** | ⭐⭐⭐⭐⭐ TypeScript 项目适用 |

### C3: 复杂逻辑添加注释

| 项目 | 内容 |
|------|------|
| **问题信号** | "看不懂这段代码"、"为什么要这样写" |
| **根本原因** | 复杂逻辑没有解释 |
| **规则** | 非显而易见的逻辑添加简短注释 |
| **自动化** | 无，靠 review |
| **来源** | commit `25edac96c` - add note about tricky code comments |
| **通用程度** | ⭐⭐⭐⭐⭐ 所有项目适用 |

### C4: 回答前验证代码

| 项目 | 内容 |
|------|------|
| **问题信号** | "回答是错的"、"猜测的信息不准确" |
| **根本原因** | 没有验证就回答 |
| **规则** | 回答问题时，只回答高置信度的答案；在代码中验证，不要猜测 |
| **自动化** | 无，靠规则约束 |
| **来源** | commit `b1d4bd0f7` - require code-verified answers |
| **通用程度** | ⭐⭐⭐⭐⭐ 所有项目适用 |

### C5: 使用项目标准工具

| 项目 | 内容 |
|------|------|
| **问题信号** | "重复造轮子"、"风格不一致" |
| **根本原因** | 没有使用现有工具 |
| **规则** | 优先使用项目已有的标准工具库（如 progress、table、logger），不重复造轮子 |
| **自动化** | 无，靠 review |
| **来源** | CLAUDE.md 第 132-133 行 |
| **通用程度** | ⭐⭐⭐⭐ 有标准工具的项目适用 |

### C6: 不要硬编码颜色

| 项目 | 内容 |
|------|------|
| **问题信号** | "颜色不一致"、"主题支持有问题" |
| **根本原因** | 硬编码颜色值 |
| **规则** | 使用共享的 palette/theme 系统，不硬编码颜色值 |
| **自动化** | 无，靠 review |
| **来源** | CLAUDE.md 第 156 行 |
| **通用程度** | ⭐⭐⭐⭐ 有 CLI/UI 的项目适用 |

### C7: 提取 helpers 而非 V2 复制

| 项目 | 内容 |
|------|------|
| **问题信号** | "代码重复"、"fooV2 这样的命名" |
| **根本原因** | 复制粘贴而非抽象 |
| **规则** | 保持文件简洁，提取 helpers 而非创建 "V2" 复制 |
| **自动化** | 无，靠 review |
| **来源** | CLAUDE.md 第 61 行 |
| **通用程度** | ⭐⭐⭐⭐⭐ 所有项目适用 |

### C8: Bug 调查要读源码

| 项目 | 内容 |
|------|------|
| **问题信号** | "根因分析不准确"、"没找到真正的问题" |
| **根本原因** | 没有深入调查 |
| **规则** | 调查 bug 时，读取相关 npm 依赖的源码和所有相关本地代码；追求高置信度的根因 |
| **自动化** | 无，靠规则约束 |
| **来源** | CLAUDE.md 第 158 行 |
| **通用程度** | ⭐⭐⭐⭐⭐ 所有项目适用 |

---

## 知识规则

### K1: 版本号位置清单

| 项目 | 内容 |
|------|------|
| **问题信号** | "版本号不一致"、"忘了更新某个地方" |
| **根本原因** | 版本号分散在多个文件 |
| **规则** | 文档中列出所有版本号位置（package.json, Info.plist, build.gradle.kts 等） |
| **自动化** | 可写脚本统一更新 |
| **来源** | CLAUDE.md 第 139 行 |
| **通用程度** | ⭐⭐⭐⭐ 多平台项目适用 |

### K2: 项目结构说明

| 项目 | 内容 |
|------|------|
| **问题信号** | "文件应该放哪里"、"这个目录是干什么的" |
| **根本原因** | 项目结构没有文档 |
| **规则** | AGENTS.md 中说明目录结构（src/, tests/, docs/, extensions/ 等） |
| **自动化** | 无 |
| **来源** | CLAUDE.md 第 8-18 行 |
| **通用程度** | ⭐⭐⭐⭐⭐ 所有项目适用 |

### K3: 内部术语表

| 项目 | 内容 |
|------|------|
| **问题信号** | "什么是 XXX"、"不理解这个词" |
| **根本原因** | 项目有内部术语 |
| **规则** | 在 AGENTS.md 中记录项目内部术语和缩写的含义 |
| **自动化** | 无 |
| **来源** | CLAUDE.md 第 124 行 |
| **通用程度** | ⭐⭐⭐ 有内部术语的项目适用 |

### K4: 新增模块检查清单

| 项目 | 内容 |
|------|------|
| **问题信号** | "新模块缺少配置"、"遗漏了某个位置" |
| **根本原因** | 添加新模块时遗漏了相关位置 |
| **规则** | 为常见操作（添加新模块、新页面、新 API）创建检查清单，列出需要更新的所有位置 |
| **自动化** | 无，靠检查清单 |
| **来源** | CLAUDE.md 第 138 行 |
| **通用程度** | ⭐⭐⭐⭐ 模块化项目适用 |

### K5: 工具 schema 兼容性

| 项目 | 内容 |
|------|------|
| **问题信号** | "工具 schema 被拒绝"、"Provider 不支持" |
| **根本原因** | 使用了不兼容的 schema 特性 |
| **规则** | 记录 schema 兼容性限制（如避免 union types、保留关键字等），确保跨 provider 兼容 |
| **自动化** | 可在测试中检查 |
| **来源** | commit `de3158302` - avoid format keyword in tool schemas |
| **通用程度** | ⭐⭐⭐ 有工具/API schema 的项目适用 |

### K6: 发布前阅读文档

| 项目 | 内容 |
|------|------|
| **问题信号** | "发布流程不对"、"问了文档里已有的问题" |
| **根本原因** | 没有阅读发布文档 |
| **规则** | 发布前总是阅读 RELEASING.md 和 release.md，不要问文档已回答的常规问题 |
| **自动化** | 无 |
| **来源** | CLAUDE.md 第 116 行 |
| **通用程度** | ⭐⭐⭐⭐ 有发布流程的项目适用 |

### K7: 测试指南位置

| 项目 | 内容 |
|------|------|
| **问题信号** | "不知道怎么跑测试"、"live test 怎么配置" |
| **根本原因** | 测试文档不明确 |
| **规则** | 文档中说明测试命令、coverage 要求、live test 配置等 |
| **自动化** | 无 |
| **来源** | CLAUDE.md 第 73-80 行 |
| **通用程度** | ⭐⭐⭐⭐⭐ 有测试的项目适用 |

### K8: 平台特定指南

| 项目 | 内容 |
|------|------|
| **问题信号** | "macOS 构建失败"、"iOS 签名问题" |
| **根本原因** | 平台特定知识缺失 |
| **规则** | 记录平台特定的操作指南（Mac app 打包、iOS Team ID 查找、SSH 重建限制等） |
| **自动化** | 无 |
| **来源** | CLAUDE.md 第 134-145 行 |
| **通用程度** | ⭐⭐⭐ 多平台项目适用 |

---

## 文档规则

### D1: 文档使用通用示例

| 项目 | 内容 |
|------|------|
| **问题信号** | "文档包含真实设备名"、"路径是硬编码的" |
| **根本原因** | 使用了个人信息 |
| **规则** | 文档内容必须通用，使用 `user@gateway-host` 这样的 placeholder，不用真实设备名/路径 |
| **自动化** | 无，靠 review |
| **来源** | commit `e3be5f836` - require generic docs examples |
| **通用程度** | ⭐⭐⭐⭐⭐ 所有项目适用 |

### D2: 文档链接格式规范

| 项目 | 内容 |
|------|------|
| **问题信号** | "文档链接 404"、"anchor 不工作" |
| **根本原因** | 链接格式不符合文档平台要求 |
| **规则** | 记录文档平台的链接格式要求（如 root-relative、无扩展名、标题字符限制等） |
| **自动化** | 可用 broken-links 检查 |
| **来源** | commit `44a954b36` - add Mintlify link rules |
| **通用程度** | ⭐⭐⭐⭐ 有文档站的项目适用 |

### D3: 修改文档后输出 URL

| 项目 | 内容 |
|------|------|
| **问题信号** | "不知道改了哪些文档" |
| **根本原因** | 没有反馈 |
| **规则** | 修改文档后，在回复末尾列出引用的完整 URL |
| **自动化** | 无，靠规则约束 |
| **来源** | commit `cb35db0c7` - note to echo docs links after edits |
| **通用程度** | ⭐⭐⭐⭐ 有文档站的项目适用 |

### D4: GitHub newline 处理

| 项目 | 内容 |
|------|------|
| **问题信号** | "Issue 评论格式乱了"、"换行没生效" |
| **根本原因** | `\n` 转义问题 |
| **规则** | GitHub issues/comments 用 literal multiline 或 `-F - <<'EOF'`，不要嵌入 `\\n` |
| **自动化** | 无 |
| **来源** | commit `891a2cc64` - tighten GitHub newline guidance |
| **通用程度** | ⭐⭐⭐⭐ 使用 GitHub 的项目适用 |

---

## 工具规则

### T1: 工具 schema 避免 Union

| 项目 | 内容 |
|------|------|
| **问题信号** | "工具被拒绝"、"schema 不兼容" |
| **根本原因** | 某些 provider 不支持复杂 schema |
| **规则** | 避免 `Type.Union`；无 `anyOf`/`oneOf`/`allOf`；用 `stringEnum` 代替字符串 union |
| **自动化** | 可在测试中检查 |
| **来源** | CLAUDE.md 第 160 行 |
| **通用程度** | ⭐⭐⭐ 有工具定义的项目适用 |

### T2: 工具 schema 避免 format

| 项目 | 内容 |
|------|------|
| **问题信号** | "schema 验证失败" |
| **根本原因** | `format` 是保留关键字 |
| **规则** | 避免在工具 schema 中使用 `format` 作为属性名 |
| **自动化** | 可在测试中检查 |
| **来源** | commit `de3158302` - fix: avoid format keyword in tool schemas |
| **通用程度** | ⭐⭐⭐ 有工具定义的项目适用 |

---

## 发布规则

### R1: 发布需要明确批准

| 项目 | 内容 |
|------|------|
| **问题信号** | "意外发布了"、"不该发的版本发了" |
| **根本原因** | 没有确认就发布 |
| **规则** | 修改版本号或运行 npm publish 前，必须获得明确批准 |
| **自动化** | 无，靠规则约束 |
| **来源** | CLAUDE.md 第 169 行 |
| **通用程度** | ⭐⭐⭐⭐⭐ 所有有发布的项目适用 |

### R2: 纯测试改动不需要 changelog

| 项目 | 内容 |
|------|------|
| **问题信号** | "changelog 太杂"、"测试改动也要记吗" |
| **根本原因** | 不清楚什么需要 changelog |
| **规则** | 纯测试添加/修复一般不需要 changelog，除非改变了用户可见行为或用户要求 |
| **自动化** | 无 |
| **来源** | commit `84f259534` - note changelog not needed for pure tests |
| **通用程度** | ⭐⭐⭐⭐⭐ 有 changelog 的项目适用 |

### R3: Changelog 格式

| 项目 | 内容 |
|------|------|
| **问题信号** | "changelog 格式不一致" |
| **根本原因** | 没有统一格式 |
| **规则** | 最新发布版本在顶部（无 Unreleased）；发布后 bump 版本并开始新的顶部章节 |
| **自动化** | 无 |
| **来源** | CLAUDE.md 第 87 行 |
| **通用程度** | ⭐⭐⭐⭐ 有 changelog 的项目适用 |

### R4: 发布流程文档化

| 项目 | 内容 |
|------|------|
| **问题信号** | "发布失败"、"OTP 过期了"、"不知道发布步骤" |
| **根本原因** | 发布流程没有文档 |
| **规则** | 在 AGENTS.md 中记录完整的发布流程（获取 OTP、运行发布命令、验证结果等） |
| **自动化** | 可用发布脚本 |
| **来源** | CLAUDE.md 第 171-178 行 |
| **通用程度** | ⭐⭐⭐⭐ 有发布流程的项目适用 |

---

## 规则演进追踪

以下是 OpenClaw 项目中规则引入的关键时间点：

| 日期 | Commit | 规则 | 类型 |
|------|--------|------|------|
| 2025-11-25 | `102735d48` | 初始 AGENTS.md（基础规则） | 初始化 |
| 2025-12-13 | `952810f76` | 禁止 git stash | 协作安全 |
| 2025-12-17 | `cc235fc31` | 禁止切换分支 | 协作安全 |
| 2025-12-19 | `beb5b1ad5` | 禁止修改 worktree | 协作安全 |
| 2025-12-20 | `9fa919974` | 多 Agent 独立 session | 协作安全 |
| 2025-12-21 | `753995a91` | 禁止提交真实数据 | 安全 |
| 2025-12-22 | `9c32e630a` | 500 LOC 上限 | 代码质量 |
| 2025-12-26 | `b1d4bd0f7` | 验证代码后回答 | 质量 |
| 2026-01-05 | `f07c39b26` | Lint/format 自动处理 | 流程 |
| 2026-01-08 | `a40fd5219` | 不认识的文件继续工作 | 协作 |
| 2026-01-15 | `52e9450a7` | Review 前 git pull | 流程 |
| 2026-01-18 | `173bce34b` | Patch 需要批准 | 安全 |
| 2026-01-20 | `868952f95` | 发布 guardrails | 发布 |
| 2026-01-25 | `de3158302` | Tool schema format 限制 | 工具 |

---

## 规则统计

| 类别 | 数量 | 覆盖场景 |
|------|------|----------|
| 安全规则 (S) | 7 | 提交、依赖、敏感信息 |
| 协作规则 (M) | 10 | 多 Agent、分支、冲突 |
| 流程规则 (P) | 11 | PR、提交、测试 |
| 风格规则 (C) | 8 | 代码质量、注释 |
| 知识规则 (K) | 8 | 文档、结构、指南 |
| 文档规则 (D) | 4 | 链接、格式、示例 |
| 工具规则 (T) | 2 | Schema 兼容性 |
| 发布规则 (R) | 4 | 版本、changelog、发布 |
| **总计** | **54** | |
